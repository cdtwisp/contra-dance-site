<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evening Contra Dance</title>
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <style>
        body {
            font-family: 'Georgia', serif;
            margin: 0;
            padding: 0;
            background-color: #f5f1e9;
            color: #1a1a1a;
            text-align: center;
        }
        header {
            background-color: #1a1a1a;
            color: #f5f1e9;
            padding: 20px;
            border-bottom: 10px solid #4a2c2a;
            width: 100%;
        }
        header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .event-subtitle {
            font-size: 0.8em;
            font-style: italic;
            color: #ccc;
            margin-top: -0.5em;
            margin-bottom: 0;
            text-align: center;
        }
        .menu-bar {
            background-color: #1a1a1a;
            padding: 10px 0;
            border-bottom: 2px solid #4a2c2a;
            width: 100%;
        }
        .menu-bar ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .menu-bar ul li a {
            color: #f5f1e9;
            text-decoration: none;
            font-size: 1.2em;
            padding: 5px 15px;
        }
        .menu-bar ul li a:hover {
            background-color: #2e1a18;
            border-radius: 5px;
        }
        .main-content {max-width:1200px;margin:0 auto;padding:20px;}
        .event-details {margin:20px 0;background-image:url('https://raw.githubusercontent.com/cdtwisp/contra-dance-site/main/contra-dance-poster.png');padding:20px;border:2px solid #4a2c2a;border-radius:5px;background-size:cover;background-position:center;color:#1a1a1a;}
        .event-details h2 {color:#4a2c2a;font-size:1.8em;font-weight:bold;}
        .event-details p {font-size:1.2em;line-height:1.6;}
        .highlights {display:flex;flex-wrap:wrap;justify-content:center;gap:20px;margin:20px 0;width:100%;}
        .highlight {background:rgba(245,241,233,0.9);border:2px solid #1a1a1a;border-radius:5px;padding:15px;box-shadow:0 2px 5px rgba(0,0,0,0.1);flex:1;min-width:200px;position:relative;}
        .highlight p {margin:0;font-size:1.1em;color:#1a1a1a;}
        .highlight:before {content:"♪";position:absolute;top:-10px;left:10px;color:#4a2c2a;font-size:1.5em;}
        .cta {margin:30px 0;}
        .cta p {font-size:1.2em;color:#4a2c2a;}
        .social-share {margin:30px 0;display:flex;justify-content:center;gap:15px;flex-wrap:wrap;}
        .social-share a {display:inline-flex;align-items:center;gap:8px;padding:10px 15px;background:#4a2c2a;color:#f5f1e9;text-decoration:none;border-radius:5px;font-size:1em;transition:background 0.3s;}
        .social-share a:hover {background:#2e1a18;}
        footer {background:#1a1a1a;color:#f5f1e9;padding:10px;margin-top:20px;border-top:5px solid #4a2c2a;width:100%;}
        @media (max-width:768px) {
            header h1 {font-size:2em;}
            .event-subtitle {font-size:0.75em;}
            .menu-bar ul {gap:10px;}
            .menu-bar a {font-size:1em;padding:5px 10px;}
            .highlight {min-width:100px;}
            .social-share {flex-direction:column;align-items:center;}
            .social-share a {width:100%;max-width:250px;justify-content:center;}
        }
    </style>
</head>
<body>
    <header>
        <h1>Evening Contra Dance</h1>
        <p class="event-subtitle">Methow Valley UMC Fellowship Hall, Twisp WA</p>
    </header>

    <nav class="menu-bar">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="calendar.html">Calendar</a></li>
            <li><a href="location.html">Location & Directions</a></li>
        </ul>
    </nav>

    <div class="main-content">
        <div class="event-details">
            <h2 id="dynamic-date">Loading…</h2>
            <p>Join us for an evening of easy and fun contra dancing! This social, upbeat community folk dance features simple patterns anyone can learn — no experience or partner needed.</p>
            <p>We teach all the steps before each dance, making it perfect for everyone. Come to dance or just soak up the great company!</p>
        </div>

        <div class="highlights">
            <div class="highlight"><p>Free Event</p></div>
            <div class="highlight"><p>Great for beginners</p></div>
            <div class="highlight"><p>Come solo or with a friend</p></div>
            <div class="highlight"><p>Drop in anytime — stay as long as you like</p></div>
            <div class="highlight"><p>Comfortable shoes recommended</p></div>
            <div class="highlight"><p>Wear whatever you feel good moving in — casual is perfect</p></div>
        </div>

        <div class="cta">
            <p>Let’s share music, movement, and connection. Hope to see you there!</p>
        </div>

        <div class="social-share">
            <a href="#" onclick="shareFacebook()">Share on Facebook</a>
            <a href="#" onclick="shareTwitter()">Share on X (Twitter)</a>
            <a href="#" onclick="shareInstagram()">Share on Instagram</a>
            <a href="#" onclick="shareTikTok()">Share on TikTok</a>
        </div>
    </div>

    <footer>
        <p>More info: contradancetwisp@gmail.com</p>
    </footer>

<script>
    async function updateNextDanceFromCalendar() {
        const icsUrl = 'https://calendar.google.com/calendar/ical/217441404dc6a29d7235149306cef04f1c6508908b01bf5cbad1ac59a4267cdc%40group.calendar.google.com/public/basic.ics';
        
        try {
            const response = await fetch(icsUrl);
            if (!response.ok) throw new Error('Fetch failed');
            const icsText = await response.text();
            
            const lines = icsText.split('\n');
            const events = [];
            let currentEvent = null;
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (trimmed.startsWith('BEGIN:VEVENT')) {
                    currentEvent = {};
                } else if (trimmed.startsWith('DTSTART') && currentEvent) {
                    const dateStr = trimmed.split(':')[1];
                    if (dateStr && dateStr.length >= 8) {
                        const year = dateStr.substr(0,4);
                        const month = parseInt(dateStr.substr(4,2)) - 1;
                        const day = dateStr.substr(6,2);
                        currentEvent.date = new Date(year, month, day);
                    }
                } else if (trimmed.startsWith('SUMMARY') && currentEvent) {
                    currentEvent.summary = trimmed.split(':')[1] || '';
                } else if (trimmed.startsWith('END:VEVENT') && currentEvent && currentEvent.date) {
                    if (currentEvent.summary.toLowerCase().includes('contra')) {
                        events.push(currentEvent.date);
                    }
                }
            }
            
            if (events.length === 0) throw new Error('No contra events found');
            
            events.sort((a,b) => a - b);
            const today = new Date();
            today.setHours(0,0,0,0);
            
            let nextEvent = null;
            for (const event of events) {
                if (event >= today) {
                    nextEvent = event;
                    break;
                }
            }
            
            if (!nextEvent && events.length > 0) {
                nextEvent = new Date(events[events.length - 1]);
                nextEvent.setDate(nextEvent.getDate() + 7);
            }
            
            if (nextEvent) {
                const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
                const h2 = document.querySelector('.event-details h2');
                if (h2) {
                    h2.textContent = `This Coming Saturday, ${monthNames[nextEvent.getMonth()]} ${nextEvent.getDate()} | 6:00–9:00 PM`;
                }
            }
        } catch (error) {
            console.warn('Calendar fetch failed – using weekly Saturday fallback');
            const today = new Date();
            const weekday = today.getDay();
            let daysToAdd = (weekday === 6) ? 0 : (6 - weekday + 7) % 7 || 7;
            const nextSaturday = new Date(today);
            nextSaturday.setDate(today.getDate() + daysToAdd);
            const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
            const h2 = document.querySelector('.event-details h2');
            if (h2) h2.textContent = `This Coming Saturday, ${monthNames[nextSaturday.getMonth()]} ${nextSaturday.getDate()} | 6:00–9:00 PM`;
        }
    }
    
    updateNextDanceFromCalendar();

    // Your social sharing (unchanged)
    const shareText = "Unlock Twisp contra: Teaches per dance, free door. Show Saturdays & dance the night. ";
    const currentUrl = encodeURIComponent(window.location.href);
    function shareFacebook() { window.open(`https://www.facebook.com/sharer/sharer.php?u=${currentUrl}`,'_blank'); }
    function shareTwitter() { window.open(`https://twitter.com/intent/tweet?url=${currentUrl}&text=${encodeURIComponent(shareText + currentUrl + ' #ContraDance #Twisp')}`,'_blank'); }
    async function shareInstagram() { try { await navigator.clipboard.writeText(shareText + currentUrl); alert('Copied! Paste into IG'); } catch { prompt('Copy:', shareText + currentUrl); } }
    async function shareTikTok() { shareInstagram(); }
</script>
</body>
</html>
